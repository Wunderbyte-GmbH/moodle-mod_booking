define("mod_booking/dynamicoptiondateform",["exports","core_form/dynamicform","core_form/modalform","core/templates","core/notification"],(function(_exports,_dynamicform,_modalform,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    mod_booking
   * @copyright  2022 Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initmodaloptiondateform=_exports.initdynamicoptiondateform=_exports.datelistinit=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates);var optiondateForm=new _dynamicform.default(document.querySelector("#optiondates-form"),"mod_booking\\form\\dynamicoptiondateform");_exports.initdynamicoptiondateform=function(cmid,bookingid,optionid,modalTitle,formClass){optiondateForm.load({cmid:cmid,bookingid:bookingid,optionid:optionid,modalTitle:modalTitle,formClass:formClass}).then((function(){datelistinit(),initmodaloptiondateform(modalTitle,formClass)})).catch((function(ex){return(0,_notification.exception)(ex)})),optiondateForm.addEventListener(optiondateForm.events.SERVER_VALIDATION_ERROR,(function(){datelistinit(),initmodaloptiondateform(modalTitle,formClass)})),optiondateForm.addEventListener(optiondateForm.events.FORM_SUBMITTED,(function(e){var chooseperiodvalue=document.querySelector('[name="chooseperiod"]').value,reoccurringdatestringvalue=document.querySelector('[name="reoccurringdatestring"]').value;optiondateForm.load({cmid:cmid,bookingid:bookingid,optionid:optionid,modalTitle:modalTitle,formClass:formClass}).then((function(){e.preventDefault();var response=e.detail;_templates.default.renderForPromise("mod_booking/bookingoption_dates",response).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.replaceNodeContents(".optiondates-list",html,js)})).catch((function(ex){return(0,_notification.exception)(ex)}));for(var oldlists=document.getElementsByClassName("optiondates-list");oldlists.length>1;)oldlists[oldlists.length-1].parentNode.removeChild(oldlists[oldlists.length-1]);datelistinit(),document.querySelector('[name="chooseperiod"]').value=chooseperiodvalue,document.querySelector('[name="reoccurringdatestring"]').value=reoccurringdatestringvalue,document.querySelector("#semesterid").value=chooseperiodvalue,document.querySelector("#dayofweektime").value=reoccurringdatestringvalue,initmodaloptiondateform(modalTitle,formClass)})).catch((function(ex){return(0,_notification.exception)(ex)}))}))};var datelistinit=function(){var dateform=document.querySelector("#optiondates-form"),datelist=document.querySelector(".optiondates-list");datelist.parentNode.removeChild(datelist),dateform.parentNode.insertBefore(datelist,dateform.nextSibling),datelist.addEventListener("click",(function(e){var action=e.target.dataset.action,targetid=e.target.dataset.targetid;if("delete"===action&&(e.target.closest("li").remove(),document.getElementById(targetid).remove()),"add"===action){var targetElement=e.target.closest("li"),element='<li><span class="badge bg-primary">'+document.querySelector("#meeting-time").value+'</span> <i class="fa fa-trash ml-2 icon-red" data-action="delete"></i></li>';targetElement.insertAdjacentHTML("afterend",element)}})),document.querySelector('[name="chooseperiod"]').addEventListener("change",(function(e){document.querySelector("#semesterid").value=e.target.value})),waitForElm('input[name="reoccurringdatestring"]').then((function(stringelm){var submitbutton=document.querySelector('#optiondates-form input[name="submitbutton"]');stringelm.value.trim().toLowerCase().includes("block")?submitbutton.style.display="none":submitbutton.style.display="block"})),document.querySelector('input[name="reoccurringdatestring"]').addEventListener("keyup",(function(e){var submitbutton=document.querySelector('#optiondates-form input[name="submitbutton"]');e.target.value.trim().toLowerCase().includes("block")?submitbutton.style.display="none":submitbutton.style.display="block",document.querySelector("#dayofweektime").value=e.target.value}))};_exports.datelistinit=datelistinit;var initmodaloptiondateform=function(modalTitle,formClass){waitForElm('button[name="customdatesbtn"]').then((function(customdatesbtn){customdatesbtn.addEventListener("click",(function(e){e.preventDefault();var modalform=new _modalform.default({formClass:formClass,modalConfig:{title:modalTitle},returnFocus:e.currentTarget});modalform.addEventListener(modalform.events.FORM_SUBMITTED,(function(e){var response=e.detail;_templates.default.renderForPromise("mod_booking/bookingoption_dates_custom_list_items",response).then((function(_ref2){var html=_ref2.html,js=_ref2.js;_templates.default.appendNodeContents("ul.reoccurringdates",html,js)})).catch((function(ex){return(0,_notification.exception)(ex)})),_templates.default.renderForPromise("mod_booking/bookingoption_dates_custom_hidden_inputs",response).then((function(_ref3){var html=_ref3.html,js=_ref3.js;_templates.default.appendNodeContents("div.optiondates-list",html,js)})).catch((function(ex){return(0,_notification.exception)(ex)}))})),modalform.show()}))}))};function waitForElm(selector){return new Promise((function(resolve){if(document.querySelector(selector))return resolve(document.querySelector(selector));var observer=new MutationObserver((function(){document.querySelector(selector)&&(resolve(document.querySelector(selector)),observer.disconnect())}));observer.observe(document.body,{childList:!0,subtree:!0})}))}_exports.initmodaloptiondateform=initmodaloptiondateform}));

//# sourceMappingURL=dynamicoptiondateform.min.js.map