define("mod_booking/performance_chart",["core/chartjs","core/ajax","jquery"],(function(Chart,Ajax,$){let chartInstance=null;const createChart=(canvas,data)=>{const datasets=(data.datasets||[]).map((ds=>({label:ds.label,data:ds.data,borderColor:ds.borderColor||ds.backgroundColor,backgroundColor:"transparent",fill:!1,tension:.2,pointRadius:3,pointHoverRadius:5})));return new Chart(canvas.getContext("2d"),{type:"line",data:{datasets:datasets},options:{responsive:!0,maintainAspectRatio:!1,parsing:!1,plugins:{legend:{position:"right",align:"start"},tooltip:{callbacks:{label:function(ctx){return ctx.dataset.label+": "+ctx.parsed.y}}}},scales:{x:{type:"linear",ticks:{callback:function(value){return new Date(1e3*value).toISOString().slice(0,10)}}},y:{beginAtZero:!0,title:{display:!0,text:"Time (ms)"}}}}})},updateChart=data=>{if(chartInstance)try{let datasets=JSON.parse(data.datasetsjson);datasets=datasets.map((ds=>{if(!Array.isArray(ds.data))return ds;if(ds.data.length&&"object"==typeof ds.data[0]&&null!==ds.data[0])return ds;const normalizedData=ds.data.map(((y,index)=>{var _chartInstance$data$d,_chartInstance$data$d2;const x=null===(_chartInstance$data$d=chartInstance.data.datasets[0])||void 0===_chartInstance$data$d||null===(_chartInstance$data$d2=_chartInstance$data$d.data[index])||void 0===_chartInstance$data$d2?void 0:_chartInstance$data$d2.x;return null==x||null==y?null:{x:x,y:y}})).filter((p=>null!==p));return Object.assign({},ds,{data:normalizedData})})),chartInstance.data.datasets=datasets,chartInstance.update()}catch(e){console.error("Failed to update chart data:",e)}},registerSidebarClicks=()=>{$(".booking-sidebar-item a").on("click",(function(e){e.preventDefault();const hash=$(this).data("hash");hash&&Ajax.call([{methodname:"mod_booking_get_performance_chart",args:{value:hash},done:function(response){updateChart(response)},fail:function(error){console.error("Error loading chart data",error)}}])}))};return{init:(canvasId,dataScriptId)=>{const canvas=document.getElementById(canvasId),dataNode=document.getElementById(dataScriptId);if(!canvas||!dataNode)return;let parsed;try{parsed=JSON.parse(dataNode.textContent)}catch(e){return void console.error("Invalid chart data JSON:",e)}chartInstance=createChart(canvas,parsed),registerSidebarClicks()},updateChart:updateChart}}));

//# sourceMappingURL=performance_chart.min.js.map