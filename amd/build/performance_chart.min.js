define("mod_booking/performance_chart",["core/chartjs","core/ajax","jquery"],(function(Chart,Ajax,$){let chartInstance=null;const createChart=(canvas,data)=>{const labels=data.labelsjson||"[]",notes=data.notesjson||"[]",datasets=(data.datasetsjson||"[]").map((ds=>({label:ds.label,data:ds.data,borderColor:ds.borderColor||ds.backgroundColor,backgroundColor:"transparent",fill:!1,tension:.2,pointRadius:3,pointHoverRadius:5,spanGaps:!1})));return new Chart(canvas.getContext("2d"),{type:"line",data:{labels:labels,datasets:datasets},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",align:"start"},tooltip:{callbacks:{label:function(ctx){return ctx.dataset.label+": "+ctx.parsed.y+" ("+ctx.label+")"},afterBody:function(items){const idx=items&&items.length?items[0].dataIndex:void 0;if(void 0===idx)return[];const note=(notes[idx]||"").toString().trim();return note?["Note: "+note]:[]}}}},scales:{x:{type:"category"},y:{beginAtZero:!0,title:{display:!0,text:"Time (ms)"}}}}})},updateChart=data=>{if(chartInstance)try{const labels=JSON.parse(data.labelsjson||"[]"),datasets=JSON.parse(data.datasetsjson);chartInstance.data.labels=labels,chartInstance.data.datasets=datasets.map((ds=>({label:ds.label,data:ds.data,borderColor:ds.borderColor||ds.backgroundColor,backgroundColor:"transparent",fill:!1,tension:.2,pointRadius:3,pointHoverRadius:5,spanGaps:!1}))),chartInstance.update()}catch(e){console.error("Failed to update chart data:",e)}},registerSidebarClicks=()=>{$(".booking-sidebar-item a").on("click",(function(e){e.preventDefault();const hash=$(this).data("hash");hash&&Ajax.call([{methodname:"mod_booking_get_performance_chart",args:{value:hash},done:function(response){updateChart(response)},fail:function(error){console.error("Error loading chart data",error)}}])}))};return{init:(canvasId,dataScriptId)=>{const canvas=document.getElementById(canvasId),dataNode=document.getElementById(dataScriptId);if(!canvas||!dataNode)return;let parsed;try{parsed=JSON.parse(dataNode.textContent)}catch(e){return void console.error("Invalid chart data JSON:",e)}chartInstance=createChart(canvas,parsed),registerSidebarClicks()},updateChart:updateChart}}));

//# sourceMappingURL=performance_chart.min.js.map