define("mod_booking/bookit",["exports","core/ajax","core/templates","core/notification"],(function(_exports,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * @module     mod_booking/bookit
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadPreBookingPage=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);var currentbookitpage={},totalbookitpages={},SELECTORS_MODALID="#sbPrePageModal",SELECTORS_INMODALDIV=" div.pageContent",SELECTORS_CONTINUEBUTTON="a.continue-button",SELECTORS_BACKBUTTON="a.back-button";function isHidden(el){var style=window.getComputedStyle(el);return"none"===style.display||"hidden"===style.visibility}_exports.init=(optionid,totalnumberofpages)=>{currentbookitpage[optionid]=0,totalbookitpages[optionid]=totalnumberofpages,function(optionid,totalnumberofpages,callback){if(totalnumberofpages<1)return;const selector=SELECTORS_MODALID+optionid+SELECTORS_INMODALDIV;let element=document.querySelector(selector);if(!element)return;var observer=new MutationObserver((function(){isHidden(element)||callback(optionid)}));for(;null!==element;){if(isHidden(element)){if(element.dataset.observed)return;return observer.observe(element,{attributes:!0}),void(element.dataset.observed=!0)}element=element.parentElement}callback(optionid,totalnumberofpages)}(optionid,totalnumberofpages,loadPreBookingPage),initializeButton(optionid,!0),initializeButton(optionid,!1)};const loadPreBookingPage=optionid=>{const selector=SELECTORS_MODALID+optionid+SELECTORS_INMODALDIV,element=document.querySelector(selector);for(;element.firstChild;)element.removeChild(element.firstChild);_ajax.default.call([{methodname:"mod_booking_load_pre_booking_page",args:{optionid:optionid,pagenumber:currentbookitpage[optionid]},done:function(res){const jsonobject=JSON.parse(res.json),templates=res.template.split(",");let dataarray=jsonobject;return templates.forEach((template=>{const data=dataarray.shift();return!data||(_templates.default.renderForPromise(template,data.data).then((_ref=>{let{html:html,js:js}=_ref;return _templates.default.appendNodeContents(selector,html,js),!0})).catch((ex=>{_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})})),!0)})),function(optionid){if(currentbookitpage[optionid]+1<totalbookitpages[optionid]){document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON).classList.remove("hidden")}else{document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON).classList.add("hidden")}if(currentbookitpage[optionid]>0){document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON).classList.remove("hidden")}else{document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON).classList.add("hidden")}}(optionid),!0},fail:function(err){console.log(err)}}])};function initializeButton(optionid,back){let selector="";selector=back?SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON:SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON;const element=document.querySelector(selector);element.dataset.initialized||(element.dataset.initialized=!0,element.addEventListener("click",(()=>{element.classList.contains("hidden")||(back?currentbookitpage[optionid]--:currentbookitpage[optionid]++,loadPreBookingPage(optionid))})))}_exports.loadPreBookingPage=loadPreBookingPage}));

//# sourceMappingURL=bookit.min.js.map