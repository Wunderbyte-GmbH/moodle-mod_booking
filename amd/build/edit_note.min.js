define ("mod_booking/edit_note",["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url"],function(a,b,c,d,e,f,g){a("body").on("click keypress","[data-inplaceeditable]",function(h){if("keypress"===h.type&&13!==h.keyCode){return}h.stopImmediatePropagation();h.preventDefault();var i=a(this),j=i.closest("[data-inplaceeditable]"),k=function(b){b.addClass("updating");var c=b.find("img.spinner");if(c.length){c.show()}else{c=a("<img/>").attr("src",g.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon");b.append(c)}},l=function(a){a.removeClass("updating");a.find("img.spinner").hide()},m=function(f,g){var h=[f.attr("data-baid"),"pending"].join("-");M.util.js_pending(h);k(f);b.call([{methodname:"mod_booking_update_bookingnotes",args:{baid:f.attr("data-baid"),note:g},done:function done(b){var d=f.attr("data-value");c.render("mod_booking/edit_bookingnotes",b).done(function(e,g){var i=a(e);c.replaceNode(f,i,g);i.find("[data-note]").focus();i.trigger({type:"updated",ajaxreturn:b,oldvalue:d});M.util.js_complete(h)})},fail:function fail(b){var c=a.Event("updatefailed",{exception:b,newvalue:g});l(f);M.util.js_complete(h);f.trigger(c);if(!c.isDefaultPrevented()){d.exception(b)}}}],!0)},n=function(a){a.find("textarea").off();a.html(a.attr("data-oldcontent"));a.removeAttr("data-oldcontent");a.removeClass("inplaceeditingon");a.find("[data-note]").focus()};(function turnEditingOn(b){b.attr("data-oldcontent",b.html());var c=function(b,d){var e=b,f;for(f=0;f<d;f++){e+=Math.floor(10*Math.random())+""}if(0===a("#"+e).length){return e}return c(b,d)};e.get_string("edittitleinstructions").done(function(d){var e=a("<span class=\"editinstructions\">"+d+"</span>").attr("id",c("id_editinstructions_",20)),g=a("<textarea rows=\"4\" cols=\"50\"></textarea>").attr("id",c("id_inplacevalue_",20)).val(b.find(".bookingnote").text()).attr("aria-describedby",e.attr("id")).addClass("ignoredirty").addClass("form-control"),h=a("<label class=\"accesshide\">"+j.attr("data-editlabel")+"</label>").attr("for",g.attr("id"));b.html("").append(e).append(h).append(g);g.focus();g.select();g.on("keyup keypress focusout",function(a){if(f.behatsiterunning&&"focusout"===a.type){return}if("keypress"===a.type&&13===a.keyCode){var c=g.val();n(b);m(b,c)}if("keyup"===a.type&&27===a.keyCode||"focusout"===a.type){n(b)}})})})(j)});return{}});
//# sourceMappingURL=edit_note.min.js.map
