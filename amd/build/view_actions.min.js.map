{"version":3,"file":"view_actions.min.js","sources":["../src/view_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for booking module\n *\n * @module mod_booking/view_actions\n * @copyright 2023 Wunderbyte GmbH <info@wunderbyte.at>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 3.1\n */\n\ndefine(['jquery', 'core/config', 'mod_booking/jquery.barrating'],\n    function($, mdlconfig) {\n        return {\n            setup: function() {\n                const queryString = window.location.search;\n                const urlParams = new URLSearchParams(queryString);\n                const id = urlParams.get('id');\n                /*\n                 * TODO: We probably will need a possibility to update a rating\n                 * as soon as you have rated something. Right now you can change it,\n                 * but nothing will happen, which is bad usability.\n                 */\n                $('.starrating').each(function(index, value) {\n                    var currentrating = $(this).data('current-rating');\n                    var itemid = $(this).data('itemid');\n                    if (!value) {\n                        // Just for stupid TravisCI rules!\n                        value = '';\n                    }\n                    var thisid = this;\n                    $(this).barrating({\n                        initialRating: currentrating,\n                        theme: 'css-stars',\n                        onSelect: function(value, text, event) {\n                            if (typeof (event) !== 'undefined') {\n                                $.ajax({\n                                    url: mdlconfig.wwwroot + \"/mod/booking/rating_rest.php?id=\" + id,\n                                    method: \"POST\",\n                                    data: {optionid: itemid, value: value}\n                                }).done(function(data) {\n                                    $(thisid).barrating('readonly', true);\n                                    $(thisid).barrating('set', data.rate);\n                                });\n                            }\n                        }\n                    });\n                });\n\n                $('#page-mod-booking-report #buttonclear')\n                        .on('click',\n                                function() {\n                                    $('#menusearchwaitinglist, #menusearchfinished, #searchdate')\n                                            .val('');\n                                    $('#searchButton').trigger('click');\n                                });\n\n                $('#page-mod-booking-report #usercheckboxall')\n                        .click(function() {\n                            $('#studentsform input:checkbox').not(this)\n                                    .prop('checked', this.checked);\n                        });\n\n                $('#page-mod-booking-report #menuratingall')\n                        .change(function() {\n                            $('#studentsform input:checkbox').not(this)\n                                    .prop('checked', 'checked');\n                            var selected = $(this).val();\n                            $('.booking-option-rating .postratingmenu.ratinginput [value=\"' + selected + '\"]')\n                                    .attr('selected', true);\n                        });\n\n                $('#page-mod-booking-report .booking-option-rating .ratinginput')\n                        .change(function() {\n                            var selectid = $(this).attr('id');\n                            var selected = selectid.replace(/\\D/g, '');\n                            $('#studentsform [id=check' + selected + ']')\n                                    .prop('checked', 'checked');\n                        });\n\n            }\n        };\n    });"],"names":["define","$","mdlconfig","setup","queryString","window","location","search","id","URLSearchParams","get","each","index","value","currentrating","this","data","itemid","thisid","barrating","initialRating","theme","onSelect","text","event","ajax","url","wwwroot","method","optionid","done","rate","on","val","trigger","click","not","prop","checked","change","selected","attr","replace"],"mappings":";;;;;;;;AAwBAA,kCAAO,CAAC,SAAU,cAAe,iCAC7B,SAASC,EAAGC,iBACD,CACHC,MAAO,eACGC,YAAcC,OAAOC,SAASC,OAE9BC,GADY,IAAIC,gBAAgBL,aACjBM,IAAI,MAMzBT,EAAE,eAAeU,MAAK,SAASC,MAAOC,WAC9BC,cAAgBb,EAAEc,MAAMC,KAAK,kBAC7BC,OAAShB,EAAEc,MAAMC,KAAK,UACrBH,QAEDA,MAAQ,QAERK,OAASH,KACbd,EAAEc,MAAMI,UAAU,CACdC,cAAeN,cACfO,MAAO,YACPC,SAAU,SAAST,MAAOU,KAAMC,YACL,IAAXA,OACRvB,EAAEwB,KAAK,CACHC,IAAKxB,UAAUyB,QAAU,mCAAqCnB,GAC9DoB,OAAQ,OACRZ,KAAM,CAACa,SAAUZ,OAAQJ,MAAOA,SACjCiB,MAAK,SAASd,MACbf,EAAEiB,QAAQC,UAAU,YAAY,GAChClB,EAAEiB,QAAQC,UAAU,MAAOH,KAAKe,eAOpD9B,EAAE,yCACO+B,GAAG,SACI,WACI/B,EAAE,4DACOgC,IAAI,IACbhC,EAAE,iBAAiBiC,QAAQ,YAG/CjC,EAAE,6CACOkC,OAAM,WACHlC,EAAE,gCAAgCmC,IAAIrB,MAC7BsB,KAAK,UAAWtB,KAAKuB,YAG1CrC,EAAE,2CACOsC,QAAO,WACJtC,EAAE,gCAAgCmC,IAAIrB,MAC7BsB,KAAK,UAAW,eACrBG,SAAWvC,EAAEc,MAAMkB,MACvBhC,EAAE,8DAAgEuC,SAAW,MACpEC,KAAK,YAAY,MAGtCxC,EAAE,gEACOsC,QAAO,eAEAC,SADWvC,EAAEc,MAAM0B,KAAK,MACJC,QAAQ,MAAO,IACvCzC,EAAE,0BAA4BuC,SAAW,KAChCH,KAAK,UAAW"}