{"version":3,"file":"performance_submit.min.js","sources":["../src/performance_submit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     mod_booking/performance_submit\n * @copyright  2018 David Bogner\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.3\n */\n\n/* eslint-disable */\ndefine(['core/ajax', 'core/notification', 'mod_booking/performance_chart'], function(Ajax, Notification, ChartModule) {\n\n    const init = () => {\n        const button = document.getElementById('performance-submit');\n        const input = document.getElementById('performance-input');\n\n        if (!button || !input) {\n            return;\n        }\n\n        button.addEventListener('click', () => {\n            const value = input.value.trim();\n\n            if (!value) {\n                Notification.alert(\n                    'Missing value',\n                    'Please select an item first.',\n                    'OK'\n                );\n                return;\n            }\n\n            const actions = {};\n            const actionInputs = document.querySelectorAll('[name^=\"actions[\"]');\n\n            actionInputs.forEach(el => {\n                const match = el.name.match(/^actions\\[([^\\]]+)\\]\\[([^\\]]+)\\]$/);\n                if (!match) {\n                    return;\n                }\n\n                const actionId = match[1];\n                const field = match[2];\n\n                if (!actions[actionId]) {\n                    actions[actionId] = {};\n                }\n\n                if (el.type === 'checkbox') {\n                    actions[actionId][field] = el.checked ? 1 : 0;\n                } else {\n                    actions[actionId][field] = el.value;\n                }\n            });\n            Ajax.call([{\n                methodname: 'mod_booking_submit_performance',\n                args: {\n                    value: value,\n                    actions: JSON.stringify(actions)\n                }\n            }])[0]\n                .then(response => {\n                    if (response.status) {\n                        Notification.addNotification({\n                            message: 'Request successful',\n                            type: 'success'\n                        });\n                        // Now trigger chart reload with submitted value.\n                        Ajax.call([{\n                            methodname: 'mod_booking_get_performance_chart',\n                            args: { value: response.hashedreceived },\n                            done: function(chartdata) {\n                                ChartModule.updateChart(chartdata);\n                            },\n                            fail: function(error) {\n                                console.error('Failed to reload chart:', error);\n                            }\n                        }]);\n                    } else {\n                        Notification.addNotification({\n                            message: response.received + ' Shortcode is not valid',\n                            type: 'error'\n                        });\n                    }\n                })\n                .catch(Notification.exception);\n        });\n    };\n\n    return { init };\n});"],"names":["define","Ajax","Notification","ChartModule","init","button","document","getElementById","input","addEventListener","value","trim","alert","actions","querySelectorAll","forEach","el","match","name","actionId","field","type","checked","call","methodname","args","JSON","stringify","then","response","status","addNotification","message","hashedreceived","done","chartdata","updateChart","fail","error","console","received","catch","exception"],"mappings":";;;;;;;;;;;;;;AA+BAA,OAAO,iCAAA,CAAC,YAAa,oBAAqB,iCAAkC,SAASC,KAAMC,aAAcC,aA+ErG,MAAO,CAAEC,KA7EIA,KACT,MAAMC,OAASC,SAASC,eAAe,sBACjCC,MAAQF,SAASC,eAAe,qBAEjCF,QAAWG,OAIhBH,OAAOI,iBAAiB,QAAS,KAC7B,MAAMC,MAAQF,MAAME,MAAMC,OAE1B,IAAKD,MAMD,YALAR,aAAaU,MACT,gBACA,+BACA,MAKR,MAAMC,QAAU,CAAA,EACKP,SAASQ,iBAAiB,sBAElCC,QAAQC,KACjB,MAAMC,MAAQD,GAAGE,KAAKD,MAAM,qCAC5B,IAAKA,MACD,OAGJ,MAAME,SAAWF,MAAM,GACjBG,MAAQH,MAAM,GAEfJ,QAAQM,YACTN,QAAQM,UAAY,IAGR,aAAZH,GAAGK,KACHR,QAAQM,UAAUC,OAASJ,GAAGM,QAAU,EAAI,EAE5CT,QAAQM,UAAUC,OAASJ,GAAGN,QAGtCT,KAAKsB,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFf,MAAOA,MACPG,QAASa,KAAKC,UAAUd,aAE5B,GACCe,KAAKC,WACEA,SAASC,QACT5B,aAAa6B,gBAAgB,CACzBC,QAAS,qBACTX,KAAM,YAGVpB,KAAKsB,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAAEf,MAAOmB,SAASI,gBACxBC,KAAM,SAASC,WACXhC,YAAYiC,YAAYD,UAC3B,EACDE,KAAM,SAASC,OACXC,QAAQD,MAAM,0BAA2BA,MAC7C,MAGJpC,aAAa6B,gBAAgB,CACzBC,QAASH,SAASW,SAAW,0BAC7BnB,KAAM,YAIjBoB,MAAMvC,aAAawC,cAKpC"}