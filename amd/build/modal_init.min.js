define("mod_booking/modal_init",["exports","core/ajax","core/templates","core/notification"],(function(_exports,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * @module     mod_booking/modal_init
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.getBookingOptionDescription=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);function respondToVisibility(optionid,userid,callback){for(var element=document.getElementById("bo_modal_spinner_"+optionid),observer=new MutationObserver((function(){isHidden(element)||(this.disconnect(),callback(optionid,userid))}));null!==element;){if(isHidden(element)){if(element.dataset.observed)return;return observer.observe(element,{attributes:!0}),void(element.dataset.observed=!0)}element=element.parentElement}callback(optionid,userid)}function isHidden(el){var style=window.getComputedStyle(el);return"none"===style.display||"hidden"===style.visibility}_exports.init=function(){var optionid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(null===optionid?document.querySelectorAll("[id^=bo_modal_spinner]"):[document.querySelector("[id^=bo_modal_spinner_"+optionid+"]")]).forEach((function(spinner){var _spinner$dataset$user;respondToVisibility(spinner.dataset.optionid,null!==(_spinner$dataset$user=spinner.dataset.userid)&&void 0!==_spinner$dataset$user?_spinner$dataset$user:0,getBookingOptionDescription)}))};var getBookingOptionDescription=function(optionid,userid){var description=document.getElementById("bo_modal_description_"+optionid),spinner=document.querySelector("#bo_modal_spinner_"+optionid+" .spinner-border");spinner&&spinner.classList.remove("hidden"),description&&description.classList.add("hidden"),_ajax.default.call([{methodname:"mod_booking_get_booking_option_description",args:{optionid:optionid,userid:userid},done:function(res){var spinner=document.querySelector("#bo_modal_spinner_"+optionid+" .spinner-border"),description=document.getElementById("bo_modal_description_"+optionid),jsonobject=JSON.parse(res.content);return _templates.default.renderForPromise(res.template,jsonobject).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.appendNodeContents("#bo_modal_description_"+optionid,html,js),spinner.classList.add("hidden"),description.classList.remove("hidden"),!0})).catch((function(ex){_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})})),spinner.classList.add("hidden"),description.classList.remove("hidden"),!0},fail:function(err){console.log(err),spinner.classList.add("hidden"),description.classList.remove("hidden")}}])};_exports.getBookingOptionDescription=getBookingOptionDescription}));

//# sourceMappingURL=modal_init.min.js.map