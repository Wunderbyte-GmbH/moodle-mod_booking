{"version":3,"file":"performance_chart.min.js","sources":["../src/performance_chart.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     mod_booking/performance_chart\n * @copyright  2018 David Bogner\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.3\n */\n\n/* eslint-disable */\ndefine(['core/chartjs', 'core/ajax', 'jquery'], function(Chart, Ajax, $) {\n\n    let chartInstance = null;\n\n    /**\n     * Initialize the chart from the DOM.\n     * @param {string} canvasId The canvas element ID.\n     * @param {string} dataScriptId The script tag with JSON data.\n     */\n    const init = (canvasId, dataScriptId) => {\n        const canvas = document.getElementById(canvasId);\n        const dataNode = document.getElementById(dataScriptId);\n\n        if (!canvas || !dataNode) {\n            return;\n        }\n\n        let parsed;\n        try {\n            parsed = JSON.parse(dataNode.textContent);\n        } catch (e) {\n            console.error('Invalid chart data JSON:', e);\n            return;\n        }\n\n        chartInstance = createChart(canvas, parsed);\n        registerSidebarClicks();\n    };\n\n    /**\n     * Create a chart.js chart instance.\n     * @param {HTMLCanvasElement} canvas The canvas to draw on.\n     * @param {Object} data JSON data with labels and datasets.\n     * @returns {Chart} The chart instance.\n     */\n    const createChart = (canvas, data) => {\n        const labels = data.labels || [];\n        const datasets = (data.datasets || []).map(ds => ({\n            label: ds.label,\n            data: ds.data,\n            backgroundColor: ds.backgroundColor,\n        }));\n\n        return new Chart(canvas.getContext('2d'), {\n            type: 'bar',\n            data: {\n                labels,\n                datasets\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        align: 'start',\n                        labels: {\n                            boxWidth: 16,\n                            padding: 12\n                        }\n                    },\n                    tooltip: { enabled: true }\n                },\n                scales: {\n                    x: { title: { display: false } },\n                    y: {\n                        beginAtZero: true,\n                        title: {\n                            display: true,\n                            text: 'Time (ms)'\n                        }\n                    }\n                }\n            }\n        });\n    };\n\n    /**\n     * Update the chart with new data (from AJAX).\n     * @param {Object} data JSON object with new labels and datasets.\n     */\n    const updateChart = (data) => {\n        if (!chartInstance) {\n            console.warn('Chart not initialized yet');\n            return;\n        }\n\n        try {\n            const labels = JSON.parse(data.labelsjson);\n            const datasets = JSON.parse(data.datasetsjson);\n\n            chartInstance.data.labels = labels;\n            chartInstance.data.datasets = datasets;\n            chartInstance.update();\n        } catch (e) {\n            console.error('Failed to parse new chart data:', e);\n        }\n    };\n\n    /**\n     * Hook up sidebar clicks to AJAX chart updates.\n     */\n    const registerSidebarClicks = () => {\n        $('.booking-sidebar-item a').on('click', function(e) {\n            e.preventDefault();\n\n            const hash = $(this).data('hash');\n            if (!hash) return;\n\n            Ajax.call([{\n                methodname: 'mod_booking_get_performance_chart',\n                args: { value: hash },\n                done: function(response) {\n                    updateChart(response);\n                },\n                fail: function(error) {\n                    console.error('Error loading chart data via AJAX', error);\n                }\n            }]);\n        });\n    };\n\n\n    return {\n        init,\n        updateChart\n    };\n});"],"names":["define","Chart","Ajax","$","chartInstance","createChart","canvas","data","labels","datasets","map","ds","label","backgroundColor","getContext","type","options","responsive","maintainAspectRatio","plugins","legend","position","align","boxWidth","padding","tooltip","enabled","scales","x","title","display","y","beginAtZero","text","updateChart","JSON","parse","labelsjson","datasetsjson","update","e","console","error","warn","registerSidebarClicks","on","preventDefault","hash","this","call","methodname","args","value","done","response","fail","init","canvasId","dataScriptId","document","getElementById","dataNode","parsed","textContent"],"mappings":";;;;;;;;;;;;;;AA+BAA,OAAO,gCAAA,CAAC,eAAgB,YAAa,UAAW,SAASC,MAAOC,KAAMC,GAElE,IAAIC,cAAgB,KAOpB,MA0BMC,YAAcA,CAACC,OAAQC,QACzB,MAAMC,OAASD,KAAKC,QAAU,GACxBC,UAAYF,KAAKE,UAAY,IAAIC,IAAIC,KAAO,CAC9CC,MAAOD,GAAGC,MACVL,KAAMI,GAAGJ,KACTM,gBAAiBF,GAAGE,mBAGxB,OAAO,IAAIZ,MAAMK,OAAOQ,WAAW,MAAO,CACtCC,KAAM,MACNR,KAAM,CACFC,cACAC,mBAEJO,QAAS,CACLC,YAAY,EACZC,qBAAqB,EACrBC,QAAS,CACLC,OAAQ,CACJC,SAAU,QACVC,MAAO,QACPd,OAAQ,CACJe,SAAU,GACVC,QAAS,KAGjBC,QAAS,CAAEC,SAAS,IAExBC,OAAQ,CACJC,EAAG,CAAEC,MAAO,CAAEC,SAAS,IACvBC,EAAG,CACCC,aAAa,EACbH,MAAO,CACHC,SAAS,EACTG,KAAM,mBAYxBC,YAAe3B,OACjB,GAAKH,cAKL,IACI,MAAMI,OAAS2B,KAAKC,MAAM7B,KAAK8B,YACzB5B,SAAW0B,KAAKC,MAAM7B,KAAK+B,cAEjClC,cAAcG,KAAKC,OAASA,OAC5BJ,cAAcG,KAAKE,SAAWA,SAC9BL,cAAcmC,QACjB,CAAC,MAAOC,GACLC,QAAQC,MAAM,kCAAmCF,EACrD,MAbIC,QAAQE,KAAK,8BAmBfC,sBAAwBA,KAC1BzC,EAAE,2BAA2B0C,GAAG,QAAS,SAASL,GAC9CA,EAAEM,iBAEF,MAAMC,KAAO5C,EAAE6C,MAAMzC,KAAK,QACrBwC,MAEL7C,KAAK+C,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAAEC,MAAOL,MACfM,KAAM,SAASC,UACXpB,YAAYoB,SACf,EACDC,KAAM,SAASb,OACXD,QAAQC,MAAM,oCAAqCA,MACvD,IAER,IAIJ,MAAO,CACHc,KAnHSA,CAACC,SAAUC,gBACpB,MAAMpD,OAASqD,SAASC,eAAeH,UACjCI,SAAWF,SAASC,eAAeF,cAEzC,IAAKpD,SAAWuD,SACZ,OAGJ,IAAIC,OACJ,IACIA,OAAS3B,KAAKC,MAAMyB,SAASE,YAChC,CAAC,MAAOvB,GAEL,YADAC,QAAQC,MAAM,2BAA4BF,EAE9C,CAEApC,cAAgBC,YAAYC,OAAQwD,QACpClB,yBAmGAV,wBAER"}